% !TeX root = ../thesis.tex

\chapter{随机传值进程}

\section{随机传值进程模型（Random VPC）}
我们将Uniform Approach中的CCS部分替换为VPC，可以得到Random VPC的语法。
$$T:=\bigoplus_{i\in I}p_i \tau.T_i\mid \sum_{i\in I} \varphi_i\lambda_i.T_i\mid T \mid T'\mid (c)T\mid \varphi T\mid !a(x).T \mid !\bar{a}(t).T$$

$\mathcal{T}_{RVPC}$为所有Random VPC项目的集合。

\subsection{Random VPC转移语义}
Uniform Approach修改了CCS的prefix操作符，
在CCS的基础上增加了随机性行为，$\oplus p\tau.T$体现了通道的随机性。

对VPC的$\bigoplus_{i\in I}p_i \tau.T_i$算子做对应的概率转移，
我们可以得到Random VPC的符号转移语义：

\begin{figure}[!htbp]
	\small
	\centering
	\includegraphics[width=13cm]{../figure/symbolic_sematic.png}
    \caption{\textbf{Symbolic Semantics}}
    \label{fig_sematic}
\end{figure}

在VPC的Symbolic Semantics中，
对于VPC的典型prefix运算$\sum \varphi \lambda. T\stackrel{\lambda}{\rightarrow}_{\varphi} T$，
我们可以通过Uniform Approach的方法将它扩展为一个概率的操作
$\bigoplus p\tau.\varphi \lambda. T\stackrel{p\tau}{\rightarrow}_{\top}\stackrel{\lambda}{\rightarrow}_{\varphi} T$。
它的语义就会变成：在概率$p$下，我们会经过一个内部$\tau$操作到达一个Random VPC状态:$\varphi\lambda.T$，
若$\mathsf{Th}\vdash \varphi$（即一阶理论$\mathsf{Th}$下，$\varphi$为真），
则我们可以经过$\lambda$操作到达Random VPC状态$T$， 其中$\lambda \in \{a(x),\bar{a}(x)\mid a\in \mathcal{N}, x\in \mathsf{V}_\Sigma, t\in \mathsf{T}_\Sigma\}\cup \{\tau\}$。

\subsection{VPC延伸性质与定义}

在CCS，Uniform Approach，VPC中，
对于if then else语法的描述仍然保留着if then else的原始格式，
我们可以根据VPC的定义给出符合VPC转移规则的if then else语法。
以下推论中$S,T\in \mathcal{T}_{\mathbb{VPC}}$。
\begin{corollary} 
   $\varphi 0 = 0$
\end{corollary}
\begin{proof}
   $\varphi 0 = \varphi 0 + 0 = \varphi 0 + \top 0 = \varphi 0 + (\varphi \vee \urcorner \varphi)0 = \varphi 0 + \varphi 0 + \urcorner \varphi 0 = \varphi 0 + \urcorner \varphi 0 = (\varphi \vee \urcorner \varphi)0 = \top 0 = 0$
\end{proof}
\begin{corollary}
   $\varphi T = (\varphi T\mid \urcorner \varphi 0)$
\end{corollary}
\begin{proof}
   $\varphi T = (\varphi T\mid 0) = (\varphi T\mid \urcorner \varphi 0)$
\end{proof}
\begin{corollary}
   $S=\varphi T$，那么当$\mathsf{Th}\vdash \urcorner \varphi$时，$S=0$。
\end{corollary}
进而我们可以得到if then else语法与VPC规则的对照表：
\begin{table}[!hpt]
   \caption[If Then Else语法对照表]{If Then Else语法对照表\footnotemark}
   \label{tab:ifthenelse}
   \centering
   \begin{tabular}{@{}cc@{}} \toprule
   %   \multicolumn{2}{c}{Item} \\ \cmidrule(r){1-2}
     语法 & $\mathbb{VPC}$规则对照 \\ \midrule
     $S=$ if $\varphi$ then $T$ else $T'$& $S=(\varphi T|\urcorner \varphi T')$\\
     $S=$ if $\varphi$ then $T$ & $S=(\varphi T|\urcorner\varphi 0)$\\
     $S = $if $\bot$ then $T$ & $S=0$\\ \bottomrule
   \end{tabular}
 \end{table}

对类似$S\stackrel{p_1\tau}{\rightarrow}_{\varphi_1}\stackrel{p_2\tau}{\rightarrow}_{\varphi_2}\cdots\stackrel{p_n\tau}{\rightarrow}_{\varphi_n} T$
考虑将他们写成这种形式: $S\stackrel{p}{\Rightarrow}_{\varphi} T$。

\begin{definition}\label{def:continous_vpc}
   根据VPC[此处应有引用]，若$S,T\in \mathcal{T}_{\mathbb{VPC}}$，$S\stackrel{\tau}{\rightarrow}_{\varphi_1}\stackrel{\tau}{\rightarrow}_{\varphi_2}\dots \stackrel{\tau}{\rightarrow}_{\varphi_n} T$，则可以记成$S\stackrel{}{\Rightarrow}_{\varphi_1\varphi_2\dots\varphi_n} T$。
\end{definition} 

而Uniform Approach中没有对连续的概率转移作类似的缩写定义，
我们根据定义2.1作出相应的定义。
\begin{definition}
   若$S,T\in \mathcal{P}_{RCCS}$，$S\stackrel{p_1\tau}{\rightarrow}\stackrel{p_2\tau}{\rightarrow}\dots\stackrel{p_n\tau}{\rightarrow}T$，则记为$S\stackrel{p_1p_2\dots p_n}{\Longrightarrow}T$。
\end{definition}

\begin{definition}
   若$S,T\in \mathcal{T}_{RVPC}$，
$S\stackrel{p_1\tau}{\rightarrow}_{\varphi_1}\stackrel{p_2\tau}{\rightarrow}_{\varphi_2}\dots \stackrel{p_n\tau}{\rightarrow}_{\varphi_n} T$，则可以记成$S\stackrel{p_1p_2\dots p_n}{\Longrightarrow}_{\varphi_1\varphi_2\dots\varphi_n} T$。
若$\varphi = \varphi_1\varphi_2\dots \varphi_n, p=p_1p_2\dots p_n$，
则可以记为$S\stackrel{p}{\Rightarrow}_{\varphi} T$。
\end{definition} 

\begin{definition}
   条件选择下的符号语义：
   若$S=\varphi (p\tau.T+(1-p)\tau.T')$，
   可以记$S\stackrel{p\tau}{\rightarrow}_{\varphi} T$。
\end{definition} 
\subsection{条件等价集}
 \begin{definition}
   $A,A'\in \mathcal{T}_{RVPC}$，若$\varphi A \mathcal{E} \varphi A'$，则$A'\in [A]_{\varphi \mathcal{E}}$。
   $[A]_{\varphi \mathcal{E}}$称为等价关系$\mathcal{E}$在条件$\varphi$下包含$A$的等价集。  
 \end{definition} 
 定义5的产生是由于：在$\mathbb{VPC}$的符号互模拟（Symbolic Bisimulation）中，
 我们考虑用必要条件下的动作去模拟充分条件下的动作[此处应有引用]。
 举个简单的例子：
 对于$A(x)=(x\geq 5)\tau.B(s(x))$
 和$A'(x)=(x\geq 3)\tau.B(s(x))$，
 $A(x)$和$A'(x)$是不符号互模拟的，
 因为不存在$x\geq 3$的划分，
 使得划分中的每一项推出$x\geq 5$的一个划分中的每一项。
 但是$(x\geq 5) A(x)$和$(x\geq 5) A'(x)$却是互模拟的，
 此时$A(x)=(x\geq 5)\tau.B(s(x)) = ((x\geq 5)\wedge (x\geq 3))\tau.B(s(x)) = (x\geq 5)A'(x)$，
 它们甚至是绝对等价的。
 在$[A]_{\varphi \mathcal{E}}$内部，
 我们可以使$\varphi$对等价性的影响透明。

\section{符号互模拟(Symbolic Bisimulation)}

% \begin{definition}
%    对任意$S,T\in \mathcal{T}_{\mathbb{VPC}_{\mathsf{Th}}}$，且$V=fv(S|T)$，
%    当$S\mathcal{R}T$且满足下列条件时，对称二元关系$\mathcal{R}$是一个符号互模拟(Symbolic Bisimulation)[此处应有引用]。
%    \begin{itemize}
%       \item [1.] 
%    \end{itemize}
% \end{definition}
\subsection{条件Epsilon树}
\begin{definition}
   \label{def:silent_tree}
   若$A\in \mathcal{T}_{RVPC}$,
   $A$的静态转移树$t$满足如下定义：
   \begin{itemize}
   \item 每一个节点都被标记成$\mathcal{T}_{RVPC}$的一个元素，$A$是根节点。
   \item {
      节点间的边被标记成$(\varphi,p)$，其中$p\in(0,1]$，$\varphi$是一个布尔表达式。
      如果一条从$A'$到$A''$的有向边被标记成$(\varphi,p)$，表示$A'\stackrel{p\tau}{\rightarrow}_{\varphi} A''$。
   }
   \end{itemize}
\end{definition}

\begin{definition}[条件Epsilon树:$\varphi \mathcal{E}$-tree]
   $A$的静态转移树是一个条件Epsilon树（$\varphi \mathcal{E}$-tree） $t^A_{\varphi \mathcal{E}}$ 
当且仅当下列条件成立
\begin{itemize}
   \item 树中的所有结点属于$[A]_{\varphi \mathcal{E}}$。
   \item 树中标记为$(\psi, q),q\in(0,1],V=fv_{\psi\wedge\varphi}$的边满足存在$V$的一组赋值$v'$使得$\mathsf{Th}\vdash \psi_{v'}\wedge\varphi_{v'}$，在$\varphi\mathcal{E}$-tree中，该边被重新标记为$(\varphi\psi,q)$。
\end{itemize}
\end{definition}

\begin{corollary}
   $A$的静态转移树是一个$\varphi \mathcal{E}$-tree $t^A_{\varphi \mathcal{E}}$ 则对于树上的节点$B,B',B_i,i\in [k]$：
   \begin{itemize}
      \item {
         $B\stackrel{(\psi,q)}{\rightarrow}B',q\in(0,1]$，则$\mathsf{Th}\vdash\psi\Rightarrow\varphi$。
      }
      \item {
         若$B\stackrel{(\psi,q)}{\rightarrow}B',q\in (0,1)$，则存在$B\stackrel{\coprod_{i\in [k]}}{\longrightarrow}_{\psi} \coprod_{i\in [k]} B_i$，
         且$B$有且仅有$B_1,\dots, B_k$这$k$个儿子节点。
      }
      \item {
         若存在$B\stackrel{(\psi,1)}{\rightarrow}B'$，则$B\stackrel{\tau}{\rightarrow}_{\psi}B'$且$B$有且仅有$B'$一个儿子节点。
      }
   \end{itemize}
\end{corollary}

条件Epsilon树的定义比较抽象，我们可以看几个简单有趣的例子：
\begin{example}
   $H(x)\stackrel{def}{=}(x\leq 3)(\frac{1}{3}\tau.(x\geq 1)G(x)\oplus\frac{1}{3}\tau.(x\geq 2)G(x)\oplus\frac{1}{3}\tau.(x\geq 3)G(x))$

   $[H(x)]_{\mathcal{E}_1} = [G(x)]_{\mathcal{E}_1}$。

   $H(x)$的静态转移树如图~\ref{fig_eg0_1}：
   \begin{figure}[!htbp]
      \caption[]{}
      \small
      \centering
      \includegraphics[width=8cm]{../figure/example0_1.png}
       \label{fig_eg0_1}
   \end{figure}

   $H(x)$的$\top\mathcal{E}_1$-tree只有一个根节点$H(x)$。

   $H(x)$的$(x>3)\mathcal{E}_1$-tree只有一个根节点$H(x)$。

   $H(x)$的$(x>2)\mathcal{E}_1$-tree如图~\ref{fig_eg0_2}：
   \begin{figure}[!htbp]
      \caption[]{}
      \small
      \centering
      \includegraphics[width=5cm]{../figure/example0_2.png}
       \label{fig_eg0_2}
   \end{figure}
\end{example}
\begin{example}\label{eg:1}
      假设我们有一个不太行的下课铃系统，每一时刻它坏掉的可能性是$\frac{1}{2}$，可以通过内部自动校准系统($\tau$操作)修复，它的内部有一个计时器，每隔定长时间（$\tau$操作）就会从$a$通道广播录好的一段下课铃。
      这个下课铃系统可以被抽象为一个Random VPC，
      我们可以用$G(x)$来表示这个系统：
      $$G(x)\stackrel{def}{=}\mu X.(\frac{1}{2}\tau.X\oplus \frac{1}{2}\tau.\overline{a}(x).X)$$
      $G(x)$在$\mathcal{E}_2$的等价集$[G(x)]_{\top\mathcal{E}_2} = [\overline{a}(x).G(x)]_{\top\mathcal{E}_2}$。
      $G(x)$的$\top \mathcal{E}_2$-tree如图~\ref{fig_eg1}：
      \begin{figure}[!htbp]
         \caption[]{}
         \small
         \centering
         \includegraphics[width=5cm]{../figure/example1.png}
          \label{fig_eg1}
      \end{figure}
\end{example}
\begin{example}\label{eg:2}
   假设之前的不太行的下课铃系统经过岁月的磨练，年久失修，
   每自动校准一次音量就会减弱，音量必须满足$y>1$才可以播放，
   当$y<0$时下课铃系统会崩溃无法修复。
   为了方便建模，我们用$\mathsf{p}(x)=x-1$来表示这种音量减弱。
   校长出于节约经费的考虑，只要下课铃还能在他办公室听见($y>3$)就可以继续使用，
   现在的下课铃系统依然是一个Random VPC，
   我们可以用修改的$G'(x,y)$来表示这个系统：
   $$G'(x,y)\stackrel{def}{=}(y>3)(\frac{1}{2}\tau.((y\geq 0)\tau.G'(x,\mathsf{p}(y)))\oplus \frac{1}{2}\tau.((y>1)\overline{a}(x).G'(x,y)))$$
   $G'(x,y)$在$(y>3)\mathcal{E}_3$的等价集$[G'(x,y)]_{(y>3)\mathcal{E_3}}=[G'(x,y')]_{(y'>3)\mathcal{E_3}}=[a(x).G'(x,y'')]_{(y''>3)\mathcal{E_3}}$，其中$y,y',y''$不一定相等。

   $G'(x,y)$的$(y>3)\mathcal{E}_3$-tree如图~\ref{fig_eg2}
   \begin{figure}[!htbp]
      \caption[]{}
      \small
      \centering
      \includegraphics[width=11cm]{../figure/example2.png}
       \label{fig_eg2}
   \end{figure}

\end{example}

\subsection{Random VPC的符号互模拟}
\begin{definition}[条件概率转移:$\varphi q$-transition]
   $A\in \mathcal{T}_{RVPC},\mathcal{B}\in (\mathcal{T}_{RVPC}/\varphi \mathcal{E})\backslash \{[A]_{\varphi\mathcal{E}}\}$，
对$t^A_{\varphi \mathcal{E}}$的每一个叶子结点$L\stackrel{\coprod_{i\in I}p_i\tau}{\longrightarrow}_{\coprod_{i\in I}\psi_i} \coprod_{i\in [k]}L_i$,
$i\in I, L_i\in \mathcal{B}$且$\mathsf{Th}\vdash \varphi \Rightarrow \psi_i$。

定义$\mathsf{P}_\varphi(L\stackrel{\coprod_{i\in I}p_i\tau}{\longrightarrow}_{\coprod_{i\in I}\psi_i}\mathcal{B}) = \sum\{p_i\mid L\stackrel{p_i\tau}{\rightarrow}_{\psi_i} L_i\in\mathcal{B} \wedge i\in I \wedge \mathsf{Th}\vdash \varphi \Rightarrow \psi_i\}$。

定义$\mathsf{P}_{\varphi \mathcal{E}}(L\stackrel{\coprod_{i\in I}p_i\tau}{\longrightarrow}_{\coprod_{i\in I}\psi_i}\mathcal{B}) = \mathsf{P}_\varphi(L\stackrel{\coprod_{i\in I}p_i\tau}{\longrightarrow}_{\coprod_{i\in I}\psi_i}\mathcal{B})/(1-\mathsf{P}_\varphi(L\stackrel{\coprod_{i\in I}p_i\tau}{\longrightarrow}_{\coprod_{i\in I}\psi_i}[A]_{\varphi\mathcal{E}}))$。

当$\mathsf{P}_{\varphi \mathcal{E}}(L\stackrel{\coprod_{i\in I}p_i\tau}{\longrightarrow}_{\coprod_{i\in I}\psi_i}\mathcal{B})=q$时，
$A$到$\mathcal{B}$存在$\varphi q$-transition。写作$A\rightsquigarrow_{\varphi\mathcal{E}} \stackrel{q}{\rightarrow}_{\varphi} \mathcal{B}$。
\end{definition}


\begin{definition}[符号互模拟]
   $\mathcal{E}$是一个$\mathcal{T}_{RVPC}$上的二元对称关系，
当$A\mathcal{E}B$且满足下列条件时，称$\mathcal{E}$是一个符号互模拟(Symbolic Bisimulation)：
\begin{itemize}
   \item {
      若$ A \rightsquigarrow_{\varphi \mathcal{E}}\stackrel{a(x)}{\rightarrow}_{\varphi} \mathcal{C}\in \mathcal{T}/\varphi\mathcal{E}, \mathcal{C}\neq [A]_{\mathcal{E}}$，
      则存在$\varphi$的划分$\{\varphi_i\}_{i\in I}$，和集合$\{B\rightsquigarrow_{\varphi_i \mathcal{E}}\stackrel{a(x)}{\rightarrow}_{\psi_i} \mathcal{C}\}$，
      使得对$i\in I$，$\mathsf{Th}\vdash \varphi_i \Rightarrow \psi_i$。
   }
   \item {
      若$A \rightsquigarrow_{\varphi \mathcal{E}}\stackrel{\bar{a}(t)}{\rightarrow}_{\varphi} \mathcal{C}\in \mathcal{T}/\varphi\mathcal{E}$，
      则存在$\varphi$的划分$\{\varphi_i\}_{i\in I}$，和集合$\{B\rightsquigarrow_{\varphi_i\mathcal{E}}\stackrel{\bar{a}(t_i)}{\rightarrow}_{\psi_i} \mathcal{C}\}$，
      使得对$i\in I$，$\mathsf{Th}\vdash (\varphi_i \Rightarrow \psi_i)\wedge (t=t_i)$。
   }
   \item {
      若$ A\rightsquigarrow_{\varphi\mathcal{E}} \stackrel{q}{\rightarrow}_{\varphi} \mathcal{C}\in \mathcal{T}/\mathcal{E}$，
      则$B\rightsquigarrow_{\varphi \mathcal{E}} \stackrel{q}{\rightarrow}_{\varphi} \mathcal{C}$
   }
\end{itemize}

\end{definition}
\begin{example}
   对于例~\ref{eg:1},~\ref{eg:2}中的两个下课铃系统，我们希望证明在$y>3$时它们是符号互模拟的，
   以此来证明校长做出了英明的决策。
\end{example}
\begin{proof}
   证明$G(x)，G'(x,y)$互模拟，需要定义它们状态的等价集，并证明等价集中的每一对等价关系满足符号互模拟的定义。
   定义等价集$\mathcal{S} = \{(G(x),G'(x,y)),(\overline{a}(x).G(x),\overline{a}(x).G'(x,y))\}$。
   \begin{itemize}
      \item {
         对于$(\overline{a}(x).G(x),\overline{a}(x).G'(x,y)$：

         对于$x$的任意赋值$t$，$\overline{a}(x).G'(x,y)\stackrel{\overline{a}(t')}{\longrightarrow}_{\top} G'(t',y)$
         可以模拟动作$\overline{a}(x).G(x)\stackrel{\overline{a}(t)}{\longrightarrow}_{\top} G(t)$，
         当且仅当$\mathsf{Th}\vdash t=t'$。对称的证明同理。
      }
      \item {

      }
   \end{itemize}
   （未完）
\end{proof}

\section{Random VPC的等价性}

\begin{lemma}
   符号互模拟具有传递性。
\end{lemma} 
\begin{proof}
   即证明若$\mathcal{E}$是一个symbolic bisimulation，$A\mathcal{E}B, B \mathcal{E} C$，则$A \mathcal{E} C$。
   \begin{itemize}
      \item {
         若$A\rightsquigarrow_{\varphi \mathcal{E}}\stackrel{\lambda}{\rightarrow} \mathcal{C}\in \mathcal{T}_{RVPC}/\varphi\mathcal{E}$，
         由于$A\mathcal{E}B$根据定义存在$\varphi$的划分$\{\varphi_i\}$和集合$\{B\rightsquigarrow_{\varphi_i\mathcal{E}}\stackrel{\lambda}{\rightarrow}_{\psi}\mathcal{C}|\mathsf{Th}\vdash \varphi_i\Rightarrow\psi_i\}$。
         对于每一个$B\rightsquigarrow_{\varphi_i\mathcal{E}}\stackrel{\lambda}{\rightarrow}_{\psi_i}\mathcal{C}$，
         $t^B_{\varphi_i\mathcal{E}}$上的每一个结点一定属于$[B]_{\psi_i\mathcal{E}}$，
         所以$t^b_{\varphi_i\mathcal{E}}$实际上是$t^b_{\psi_i\mathcal{E}}$的子树，
         $B\rightsquigarrow_{\varphi_i\mathcal{E}}\stackrel{\lambda}{\rightarrow}_{\psi_i}\mathcal{C}$中的起点终点对$\{(M,N)|(M\in t^B_{\varphi_i\mathcal{E}})\vee(N\in \mathcal{C}) \vee (M\stackrel{\lambda}{\rightarrow}_{\psi_i}N))\}$是
         $B\rightsquigarrow_{\psi_i\mathcal{E}}\stackrel{\lambda}{\rightarrow}_{\psi_i}\mathcal{C}$中的起点终点对$\{(M',N')|(M'\in t^B_{\psi_i\mathcal{E}})\vee(N'\in \mathcal{C}) \vee (M'\stackrel{\lambda}{\rightarrow}_{\psi_i}N'))\}$的子集。
         由于$B\mathcal{E}C$，对于每一个$B\rightsquigarrow_{\psi_i}\stackrel{\lambda}{\rightarrow}_{\psi_i}\mathcal{C}$，
         根据定义存在$\psi_i$的划分$\{\psi_{i,j}\}$和集合$S=\{C\rightsquigarrow_{\psi_{i,j}\mathcal{E}}\stackrel{\lambda}{\rightarrow}_{\phi_{i,j}}\mathcal{C}|\mathsf{Th}\vdash \psi_{i,j}\Rightarrow \phi_{i,j}\}$，
         那么存在$S$的子集$S'$的可以模拟$B\rightsquigarrow_{\varphi_i\mathcal{E}}\stackrel{\lambda}{\rightarrow}_{\psi_i}\mathcal{C}$。
   
         我们只需要再构建$\varphi$的划分$\{\varphi_i'\}_{i\in I}$使其一一对应$S'$中涉及的条件$\{\phi_{i,k}\}_{k\in K}\subset\{\phi_{i,j}\}_{j\in J}$即可。
         由于存在$\psi_i$的划分$\{\psi_{i,j}\}_{j\in J}$满足$\psi_{i,j}\Rightarrow \phi_{i,j}\}_{j\in J}$，
         那么我们可以构造$Con=\{\psi_{i,k}\}_{k\in [K-1]}\cup\{\bigvee_{j\in J/[K-1]}\psi_{i,j}\}$，
         对$c_k\in Con, \bigvee_{k\in K}c_k \Leftrightarrow \psi_i$， 且$Con$中元素两两互斥。
         我们用$(\bigvee Con_i)\wedge \varphi_i$代替$\varphi_i$，即可得到最终的划分。
      }
      \item {
         $\varphi q$-transition的传递性与以上过程相似。
      }
   \end{itemize}
\end{proof}
\begin{lemma}
   如果每一个$\mathcal{T}_{RVPC}$上的关系$\mathcal{E}_i$都是符号互模拟，那么$(\bigcup_{i\in I}\mathcal{E}_i)^*$是符号互模拟。
\end{lemma}
\begin{proof}
   令$\mathcal{E}=(\bigcup_{i\in I}\mathcal{E}_i)^*$。若因为$\varphi A_0\mathcal{E}_1 \varphi A_1 \mathcal{E}_2 \dots \mathcal{E}_k \varphi A_k$ ,
$(\varphi A_0, \varphi A_k)\in \mathcal{E}$，由于互模拟具有传递性，通过依次证明$A_0\mathcal{E}A_1, A_1\mathcal{E}A_2 \dots$，我们可以证明$A_0$和$A_k$互模拟。

我们可以通过$A_0$的$\varphi\mathcal{E}$-tree，$t_{A_0}$递归的构建$A_1$的$\varphi\mathcal{E}$-tree，$t_{A_1}$，
进而对$A_0\rightsquigarrow_{\varphi\mathcal{E}}\stackrel{\lambda}{\rightarrow}_{\varphi}\mathcal{C}$构造出$\{A_1\rightsquigarrow_{\varphi_i\mathcal{E}}\stackrel{\lambda}{\rightarrow}_{\psi_i} \mathcal{C}|\mathsf{Th}\vdash (\varphi_i\Rightarrow\psi_i)\vee (\textrm{$\{\varphi_i\}$是$\varphi$的一个划分})\}$。
对于每次递归的$t_{A_0}$的根结点，分以下情况讨论：

\begin{itemize}
   \item {
      \textbf{Case 1 $t_{A_0}$的根结点只有一个儿子$A_0'$。}
      \begin{itemize}
         \item {
            \textbf{Case 1.1 $A_0'\in [A_0]_{\varphi\mathcal{E}_1}$。} 则根据$A_0'$构建$A_1$的$\varphi\mathcal{E}$-tree。
         }
         \item {
            \textbf{Case 1.2 $A_0'\notin [A_0]_{\varphi\mathcal{E}_1}$。} 
            根据定义存在划分$\{\varphi_i\}$
            和集合$\{A_1\rightsquigarrow_{\varphi_i\mathcal{E}}\stackrel{\lambda}{\rightarrow}_{\psi_i} \in [A_0']_{\varphi\mathcal{E}}|\mathsf{Th}\vdash \varphi_i\Rightarrow\psi_i\}$。
            这里我们构建了一个$A_1$的$\varphi\mathcal{E}_1$-tree, $t_{A_1}'$。对$t_{A_1}'$的叶子结点$B\stackrel{\lambda}{\rightarrow}_{\psi_i} B'$中的$B'\in[A_0']_{\varphi\mathcal{E}_1}$，
            根据$A_0'$的$\varphi\mathcal{E}$-tree构建$B'$的$\varphi\mathcal{E}$-tree。
         }
      \end{itemize}
   }
   \item {
      \textbf{Case 2 $A_0$有$h$个儿子$A_0^1,\dots, A_0^h$。}
      \begin{itemize}
         \item {
            \textbf{Case 2.1 $\forall j\in [h], A^j_0\mathcal{E}_1 A_0$。}我们根据$A^1_0$构建$t_{A_1}$。
         }
         \item {
            \textbf{Case 2.2 存在$A^1_0\notin[A_0]_{\varphi\mathcal{E}_1}$。}
            令$q = \mathsf{P}_{\varphi\mathcal{E}_1}(A_0\stackrel{\coprod_{i\in [h]p_i\tau}}{\rightarrow}_{\coprod_{i\in I}\psi_i}[A^1_0]_{\varphi\mathcal{E}_1})$，
            有$A_1\rightsquigarrow_{\varphi \mathcal{E}_1}\stackrel{q}{\rightarrow}_{\varphi} [A^1_0]_{\varphi\mathcal{E}_1}$。
            对于$A_1$的$\varphi\mathcal{E}_1$-tree，$t_{A_1}'$的叶子结点$N$，$N\stackrel{\coprod_{i\in [h]}p_i\tau}{\rightarrow}_{\coprod_{i\in I}\psi_i} \coprod_{i\in I}N_i'\in [A^1_0]_{\varphi\mathcal{E}_1}$中的$N_i'$，
            根据$A^1_0$来构造$N'_i$的$\varphi\mathcal{E}$-tree。
         }
      \end{itemize}
   }
   \item {
      \textbf{Case 3 $t_{A_0}$的根结点$A_0\stackrel{\lambda}{\rightarrow}_{\varphi} L'\in \mathcal{C}$。}
      根据定义存在划分$\{\varphi_i\}, \mathsf{Th}\vdash\bigvee_{i\in I}\varphi_i \Leftrightarrow \varphi$
      和集合$\{A_1\rightsquigarrow_{\varphi_i\mathcal{E}_1}\stackrel{\lambda}{\rightarrow}_{\psi_i} \in \mathcal{C}|\mathsf{Th}\vdash \varphi_i\Rightarrow\psi_i\}$，
      由于$\mathcal{E}_1\in (\bigcup_{i\in I}\mathcal{E}_i)^*$， 我们可以得到存在集合$\{A_1\rightsquigarrow_{\varphi_i\mathcal{E}}\stackrel{\lambda}{\rightarrow}_{\psi_i} \in \mathcal{C}|\mathsf{Th}\vdash \varphi_i\Rightarrow\psi_i\}$。
   }
\end{itemize}
\end{proof}

\begin{definition}
   $\mathcal{T}_{RVPC}$上的观察等价性$\approxeq^s_{\mathsf{Th}}$定义为$\mathsf{Th}$上的符号互模拟的全集。
\end{definition}

\begin{theorem}
   $\approxeq^s_{\mathsf{Th}}$是一个等价关系。
\end{theorem}

\begin{theorem}
   $\approxeq^s_{\mathsf{Th}}$具有同余性。
\end{theorem}
\begin{proof}
   $\approxeq^s_{\mathsf{Th}}$对于随机选择和非确定性选择的封闭性比较容易证明。

对条件操作运算的封闭性在于，$S\approxeq^s_{\mathsf{Th}} T$可以推出$\varphi S \approxeq^s_{\mathsf{Th}} \varphi T$
对$\varphi S\rightsquigarrow_{\psi \approxeq^s_{\mathsf{Th}}}\stackrel{\lambda}{\rightarrow}_{\psi} \mathcal{C}\in \mathcal{T}/\psi \approxeq^s_{\mathsf{Th}}$，
有$\mathsf{Th}\vdash \varphi\psi$，且$S\rightsquigarrow_{\psi \approxeq^s_{\mathsf{Th}}}\stackrel{\lambda}{\rightarrow}_{\psi} \mathcal{C}\in \mathcal{T}/\psi \approxeq^s_{\mathsf{Th}}$，
根据定义，存在$\psi$的划分$\{\psi_i\}_{i\in I}$和集合$\{T\rightsquigarrow_{\psi_i \approxeq^s_{\mathsf{Th}}}\stackrel{\lambda}{\rightarrow}_{\phi_i}\mathcal{C}|\mathsf{Th}\vdash \psi_i\Rightarrow\phi_i\}$，
又因为$\mathsf{Th}\vdash \varphi\psi$，所以存在$j\in J\subset I, \mathsf{Th}\vdash \varphi\psi_j$，$\{\varphi T\rightsquigarrow_{\psi_j \approxeq^s_{\mathsf{Th}}}\stackrel{\lambda}{\rightarrow}_{\phi_j}\mathcal{C}|\mathsf{Th}\vdash \psi_j\Rightarrow\phi_j\}$，
重新构造$\psi$的划分为$\{\psi_j\}_{j\in [J-1]}\cup \{\bigvee_{i\in [I]/[J-1]}\psi_i\}$。q-transition的证明是类似的。

Composition和Localization的证明与Uniform Approach中的基本类似，
因为Random VPC没有对CCS的Composition和Localization做改动。

（由于时间原因这里证明的比较草率，中期检查之后会继续完善）
\end{proof}

\begin{theorem}
   若$S \approxeq^s_{\mathsf{Th}} T$，则对于每一个代换$\rho$,$S\rho \approxeq^s_{\mathsf{Th}} T\rho$
\end{theorem}
\begin{proof}
   
\end{proof}